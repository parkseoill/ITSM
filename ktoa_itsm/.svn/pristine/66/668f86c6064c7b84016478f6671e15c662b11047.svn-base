<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="FixedInspMapper">
	<resultMap id="FixedInspMng" type="truebon.com.opm.fix.model.FixedInspMngVO">
		<result property="assetId" column="ASSET_ID"/>
		<result property="assetDstnct" column="ASSET_DSTNCT"/>
		<result property="cmpnyNm" column="CMPNY_NM"/>
		<result property="maintceInspCycle" column="MAINTCE_INSP_CYCLE"/>
		<result property="fixedInspYn" column="FIXED_INSP_YN"/>
		<result property="fixedInspDate" column="FIXED_INSP_DATE"/>
		<result property="prodNm" column="PROD_NM"/>
		<result property="prodPurp" column="PROD_PURP"/>
		<result property="bizSytmNm" column="BIZ_SYTM_NM"/>
	</resultMap>

	<select id="selectFixedInspList" parameterType="truebon.com.opm.fix.model.FixedInspMngVO" resultMap="FixedInspMng">
        SELECT  
        	A.ASSET_ID
        	, A.ASSET_DSTNCT
        	, tb.CMPNY_NM 
        	, tccn1.COMN_CD_NM AS MAINTCE_INSP_CYCLE
        	, A.FIXED_INSP_YN
        	, IFNULL(CONCAT(SUBSTR(A.FIXED_INSP_DATE,1,4),'-',SUBSTR(A.FIXED_INSP_DATE,5,2),'-',SUBSTR(A.FIXED_INSP_DATE,7,2)), '') AS FIXED_INSP_DATE
        	, A.PROD_NM
        	, A.PROD_PURP
        	, tbs1.BIZ_SYTM_NM 
        FROM 
		( 	SELECT 
	 			tha.HW_ASSET_ID AS ASSET_ID
	 			, 'HW' AS ASSET_DSTNCT
	 			, tha.MAINTCE_CHRGR_NO
	 			, tha.MAINTCE_INSP_CYCLE_CD
	 			, 'Y' AS FIXED_INSP_YN 
	 			, tfi.FIXED_INSP_DATE 
	 			, tha.PROD_NM
	 			, tha.PROD_PURP
	 			, tha.BIZ_SYTM_CD
	        FROM TB_FIXED_INSP tfi
			INNER JOIN TB_HW_ASSET tha 
			ON tfi.ASSET_ID = tha.HW_ASSET_ID
			UNION ALL
			SELECT 
	 			tsa.SW_ASSET_ID AS ASSET_ID
	 			, 'SW' AS ASSET_DSTNCT
	 			, tsa.MAINTCE_CHRGR_NO
	 			, tsa.MAINTCE_INSP_CYCLE_CD
	 			, 'Y' AS FIXED_INSP_YN 
	 			, tfi.FIXED_INSP_DATE 
	 			, tsa.PROD_NM
	 			, tsa.PROD_PURP
	 			, tsa.BIZ_SYTM_CD
			FROM TB_FIXED_INSP tfi
			INNER JOIN TB_SW_ASSET tsa 
			ON tfi.ASSET_ID = tsa.SW_ASSET_ID
			UNION ALL 
			SELECT 
				tha2.HW_ASSET_ID AS ASSET_ID
				, 'HW' AS ASSET_DSTNCT
	 			, tha2.MAINTCE_CHRGR_NO
	 			, tha2.MAINTCE_INSP_CYCLE_CD
	 			, 'N' AS FIXED_INSP_YN
	 			, NULL AS FIXED_INSP_DATE 
	 			, tha2.PROD_NM
	 			, tha2.PROD_PURP
	 			, tha2.BIZ_SYTM_CD
	 		FROM TB_HW_ASSET tha2 
	 		WHERE tha2.MAINTCE_CNTR_CD = 'ITA0501'
	 		AND tha2.HW_ASSET_ID NOT IN 
	 			(SELECT tfi.ASSET_ID
                 FROM TB_FIXED_INSP tfi
                 WHERE tfi.ASSET_ID IS NOT NULL)
            UNION ALL 
			SELECT 
				tsa2.SW_ASSET_ID AS ASSET_ID
				, 'SW' AS ASSET_DSTNCT
	 			, tsa2.MAINTCE_CHRGR_NO
	 			, tsa2.MAINTCE_INSP_CYCLE_CD
	 			, 'N' AS FIXED_INSP_YN
	 			, NULL AS FIXED_INSP_DATE 
	 			, tsa2.PROD_NM
	 			, tsa2.PROD_PURP
	 			, tsa2.BIZ_SYTM_CD
	 		FROM TB_SW_ASSET tsa2 
	 		WHERE tsa2.MAINTCE_CNTR_CD = 'ITA0501'
	 		AND tsa2.SW_ASSET_ID NOT IN 
	 			(SELECT tfi.ASSET_ID
                 FROM TB_FIXED_INSP tfi
                 WHERE tfi.ASSET_ID IS NOT NULL)
		) A
		LEFT JOIN TB_CHARGER tc 
		ON A.MAINTCE_CHRGR_NO = tc.CHRGR_NO
		LEFT JOIN TB_COMPANY tb 
		ON tb.CMPNY_NO = tc.POSIT_CMPNY_NO
		LEFT JOIN TB_COMN_CD_NEW tccn1
		ON A.MAINTCE_INSP_CYCLE_CD = tccn1.NEW_COMN_CD
		LEFT JOIN TB_BIZ_SYSTEM   AS tbs1
     	ON A.BIZ_SYTM_CD  = tbs1.BIZ_SYTM_CD
     	WHERE 1=1
     	<if test="searchKeyword1 != '' and searchKeyword1 != null">
     		AND A.ASSET_DSTNCT = #{searchKeyword1}
     	</if>
     	<if test="searchKeyword2 != '' and searchKeyword2 != null">
     		AND A.FIXED_INSP_YN = #{searchKeyword2}
     	</if>
     	<if test="searchKeyword3 != '' and searchKeyword3 != null">
     		AND A.BIZ_SYTM_CD = #{searchKeyword3}
     	</if>
     	<if test="searchKeyword != null and searchKeyword != ''">
			<if test="searchCondition == 1">
				AND A.PROD_NM LIKE CONCAT('%',#{searchKeyword},'%')
			</if>
			<if test="searchCondition == 2">
				AND A.PROD_PURP LIKE CONCAT('%',#{searchKeyword},'%')
			</if>
		</if>
     	<!-- 페이징 -->
		<if test="recordCountPerPage != 0 and recordCountPerPage != null">
			limit #{recordCountPerPage} offset #{firstIndex}
		</if>
	</select>
	
	<select id="selectFixedInspListTotCnt" parameterType="truebon.com.opm.fix.model.FixedInspMngVO" resultType="int">
        SELECT COUNT(*) totcnt 
        FROM 
		( 	SELECT 
	 			tha.HW_ASSET_ID AS ASSET_ID
	 			, 'HW' AS ASSET_DSTNCT
	 			, tha.MAINTCE_CHRGR_NO
	 			, tha.MAINTCE_INSP_CYCLE_CD
	 			, 'Y' AS FIXED_INSP_YN 
	 			, tfi.FIXED_INSP_DATE 
	 			, tha.PROD_NM
	 			, tha.PROD_PURP
	 			, tha.BIZ_SYTM_CD
	        FROM TB_FIXED_INSP tfi
			INNER JOIN TB_HW_ASSET tha 
			ON tfi.ASSET_ID = tha.HW_ASSET_ID
			UNION ALL
			SELECT 
	 			tsa.SW_ASSET_ID AS ASSET_ID
	 			, 'SW' AS ASSET_DSTNCT
	 			, tsa.MAINTCE_CHRGR_NO
	 			, tsa.MAINTCE_INSP_CYCLE_CD
	 			, 'Y' AS FIXED_INSP_YN 
	 			, tfi.FIXED_INSP_DATE 
	 			, tsa.PROD_NM
	 			, tsa.PROD_PURP
	 			, tsa.BIZ_SYTM_CD
			FROM TB_FIXED_INSP tfi
			INNER JOIN TB_SW_ASSET tsa 
			ON tfi.ASSET_ID = tsa.SW_ASSET_ID
			UNION ALL 
			SELECT 
				tha2.HW_ASSET_ID AS ASSET_ID
				, 'HW' AS ASSET_DSTNCT
	 			, tha2.MAINTCE_CHRGR_NO
	 			, tha2.MAINTCE_INSP_CYCLE_CD
	 			, 'N' AS FIXED_INSP_YN
	 			, NULL AS FIXED_INSP_DATE 
	 			, tha2.PROD_NM
	 			, tha2.PROD_PURP
	 			, tha2.BIZ_SYTM_CD
	 		FROM TB_HW_ASSET tha2 
	 		WHERE tha2.MAINTCE_CNTR_CD = 'ITA0501'
	 		AND tha2.HW_ASSET_ID NOT IN 
	 			(SELECT tfi.ASSET_ID
                 FROM TB_FIXED_INSP tfi
                 WHERE tfi.ASSET_ID IS NOT NULL)
            UNION ALL 
			SELECT 
				tsa2.SW_ASSET_ID AS ASSET_ID
				, 'SW' AS ASSET_DSTNCT
	 			, tsa2.MAINTCE_CHRGR_NO
	 			, tsa2.MAINTCE_INSP_CYCLE_CD
	 			, 'N' AS FIXED_INSP_YN
	 			, NULL AS FIXED_INSP_DATE 
	 			, tsa2.PROD_NM
	 			, tsa2.PROD_PURP
	 			, tsa2.BIZ_SYTM_CD
	 		FROM TB_SW_ASSET tsa2 
	 		WHERE tsa2.MAINTCE_CNTR_CD = 'ITA0501'
	 		AND tsa2.SW_ASSET_ID NOT IN 
	 			(SELECT tfi.ASSET_ID
                 FROM TB_FIXED_INSP tfi
                 WHERE tfi.ASSET_ID IS NOT NULL)
		) A
		LEFT JOIN TB_CHARGER tc 
		ON A.MAINTCE_CHRGR_NO = tc.CHRGR_NO
		LEFT JOIN TB_COMPANY tb 
		ON tb.CMPNY_NO = tc.POSIT_CMPNY_NO
		LEFT JOIN TB_COMN_CD_NEW tccn1
		ON A.MAINTCE_INSP_CYCLE_CD = tccn1.NEW_COMN_CD
		LEFT JOIN TB_BIZ_SYSTEM   AS tbs1
     	ON A.BIZ_SYTM_CD  = tbs1.BIZ_SYTM_CD
     	WHERE 1=1
     	<if test="searchKeyword1 != '' and searchKeyword1 != null">
     		AND A.ASSET_DSTNCT = #{searchKeyword1}
     	</if>
     	<if test="searchKeyword2 != '' and searchKeyword2 != null">
     		AND A.FIXED_INSP_YN = #{searchKeyword2}
     	</if>
     	<if test="searchKeyword3 != '' and searchKeyword3 != null">
     		AND A.BIZ_SYTM_CD = #{searchKeyword3}
     	</if>
     	<if test="searchKeyword != null and searchKeyword != ''">
			<if test="searchCondition == 1">
				AND A.PROD_NM LIKE CONCAT('%',#{searchKeyword},'%')
			</if>
			<if test="searchCondition == 2">
				AND A.PROD_PURP LIKE CONCAT('%',#{searchKeyword},'%')
			</if>
		</if>
	</select>
	<select id="selectFixedInspStus" parameterType="truebon.com.opm.fix.model.FixedInspMngVO">
		   SELECT 
			     (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202301' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   1MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202301%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 1MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202302' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   2MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202302%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 2MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202303' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   3MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202303%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 3MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202304' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   4MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202304%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 4MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202305' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   5MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202305%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 5MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202306' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   6MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202306%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 6MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202307' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   7MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202307%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 7MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202308' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   8MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202308%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 8MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202309' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   9MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202309%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 9MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202310' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   10MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202310%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 10MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202311' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   11MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202311%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 11MON_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON ='202312' AND MAINTCE_INSP_CYCLE_CD ='ITA0601')   12MON_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE LIKE '202312%' AND MAINTCE_INSP_CYCLE_CD ='ITA0601') 12MON_RES  
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON BETWEEN '202301'AND '202303' AND MAINTCE_INSP_CYCLE_CD ='ITA0602')  1QU_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE BETWEEN '20230101'AND '20230331' AND MAINTCE_INSP_CYCLE_CD ='ITA0602') 1QU_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON BETWEEN '202304'AND '202306' AND MAINTCE_INSP_CYCLE_CD ='ITA0602')  2QU_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE BETWEEN '20230401'AND '20230631' AND MAINTCE_INSP_CYCLE_CD ='ITA0602') 2QU_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON BETWEEN '202307'AND '202309' AND MAINTCE_INSP_CYCLE_CD ='ITA0602')  3QU_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE BETWEEN '20230701'AND '20230931' AND MAINTCE_INSP_CYCLE_CD ='ITA0602') 3QU_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON BETWEEN '202310'AND '202312' AND MAINTCE_INSP_CYCLE_CD ='ITA0602')  4QU_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE BETWEEN '20231001'AND '20231231' AND MAINTCE_INSP_CYCLE_CD ='ITA0602') 4QU_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON BETWEEN '202301'AND '202306' AND MAINTCE_INSP_CYCLE_CD ='ITA0603')  1HALF_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE BETWEEN '20230101'AND '20230631' AND MAINTCE_INSP_CYCLE_CD ='ITA0603') 1HALF_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON BETWEEN '202307'AND '202312' AND MAINTCE_INSP_CYCLE_CD ='ITA0603')  2HALF_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE BETWEEN '20230701'AND '20231231' AND MAINTCE_INSP_CYCLE_CD ='ITA0603') 2HALF_RES
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_PLN_MON BETWEEN '202301'AND '202312' AND MAINTCE_INSP_CYCLE_CD ='ITA0604')  YEAR_PLN
			   , (SELECT COUNT(*) FROM TB_FIXED_INSP WHERE FIXED_INSP_DATE BETWEEN '20230101'AND '20231231' AND MAINTCE_INSP_CYCLE_CD ='ITA0604') YEAR_RES
			   FROM TB_FIXED_INSP tfi  
			   LIMIT 1
	</select>

</mapper>